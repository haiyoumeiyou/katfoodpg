{
    "title": "Receiving Page Meta",
    "sect_nav": [
        {"name":"order", "path":"/recv/order", "page_title": "Order Mgmt"},
        {"name":"order", "path":"/recv/recv_scan", "page_title": "Receive Scan"}

    ],
    "::order": {
        "title": "order Page Meta",
        "nav_bar": [
            {"f_id":"search", "f_event_id":"search_input", "d_name":"", "f_type":"input", "handler":"self", "container":"table", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_search"},
            {"f_id":"search", "f_event_id":"search_button", "d_name":"Search", "f_type":"button", "handler":"self", "container":"table", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_search"},
            {"f_id":"eid", "f_event_id":"new_button", "d_name":"New", "f_type":"button", "handler":"/js/part/fn_modal_input.js", "container":"dialog", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_create","auth": ["admin","manager"]}
        ],
        "table_template":{
            "table_key":"eid",
            "header":[
                {"f_id":"table_data", "d_name":"order Count", "f_type":"label"}
            ],
            "caption":"order Information",
            "fields":[
                {"f_id":"eid", "d_name":"Order ID", "f_type":"thead", "f_sort":"^"},
                {"f_id":"title", "d_name":"Receive Order", "f_type":"thead", "f_sort":"^"},
                {"f_id":"order_type", "d_name":"Order Type", "f_type":"thead", "f_sort":"^"},
                {"f_id":"status", "d_name":"Status", "f_type":"thead", "f_sort":"^"},
                {"f_id":"CreationDate", "d_name":"Create Date", "f_type":"thead"},
                {"f_id":"acct_name", "d_name":"Vendor", "f_type":"thead"},
                {"f_id":"remark", "d_name":"Remark", "f_type":"thead", "f_sort":"^"}
            ],
            "events":[
                {"f_id":"eid", "d_name":"View", "f_type":"button", "f_event_id":"view", "handler": "/js/part/fn_modal_view.js", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_view"},
                {"f_id":"eid", "d_name":"Detail", "f_type":"button", "f_event_id":"detail", "handler": "/js/part/fn_title_table.js", "container":"self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_detail"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT o.*, TO_CHAR(o.create_date, 'YYYY-MM-DD') as CreationDate, a.acct_name FROM orders o LEFT JOIN accounts a on o.vendor_id = a.eid WHERE o.order_type = 'recv' ORDER BY o.eid DESC;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_view": {
        "title": "order View Meta",
        "modal_template": {
            "fields":[
                {"f_id":"eid", "d_name":"ID", "f_type":"text", "f_element":"input", "f_attr":"disabled"},
                {"f_id":"title", "d_name":"Title", "f_type":"text", "f_element":"input", "f_attr":"disabled"},
                {"f_id":"order_type", "d_name":"Order Type", "f_element":"select", "f_data":"/api/recv/order_type", "f_option_text":"option_abbr", "f_option_val":"option_code", "f_attr":"disabled"},
                {"f_id":"status", "d_name":"Status", "f_element":"select", "f_data":"/api/recv/order_status", "f_option_text":"option_abbr", "f_option_val":"option_code"},
                {"f_id":"create_date", "d_name":"Create Date", "f_type":"text", "f_element":"input"},
                {"f_id":"vendor_id", "d_name":"Vendor", "f_element":"select", "f_data":"/api/recv/order_vendor", "f_option_text":"acct_name", "f_option_val":"eid"},
                {"f_id":"remark", "d_name":"Remark", "f_type":"text", "f_element":"input"}
            ],
            "events":[
                {"f_id":"eid", "d_name":"Update", "f_type":"button", "f_event_id":"update", "handler": "self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_update"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT eid, title, order_type, model_id, vendor_id, status, remark, TO_CHAR(create_date, 'YYYY-MM-DD') as create_date FROM orders WHERE eid = %(eid)s;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_detail": {
        "title": "order View Meta",
        "param":"param",
        "fn_key":{"order_id":"eid"},
        "title_template":{"f_id":"title","f_element":"label","f_data":"/api/recv/order_label","f_display_fields":{"title":"Order Title","status":"Status","create_date":"Creation Date"}},
        "action_bar": [
            {"f_id":"eid", "f_event_id":"delete_order", "d_name":"Delete Order", "f_type":"button", "handler":"self", "container":"self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_delete", "css_class":"danger"},
            {"f_id":"eid", "f_event_id":"import_from_csv", "d_name":"Import CSV", "f_type":"button", "f_enable_calc":"controllEnableCalcInScope", "f_enable_indicators":{"status":"fulfilled"}, "handler":"/js/part/fn_modal_import.js", "container":"dialog", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_line_import"},
            {"f_id":"eid", "f_event_id":"pick_from_list", "d_name":"Manual", "f_type":"button", "f_enable_calc":"controllEnableCalcInScope", "f_enable_indicators":{"status":"fulfilled"}, "handler":"/js/part/fn_modal_table.js", "container":"dialog", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_line_manual"},
            {"f_id":"eid", "f_event_id":"mark_order_completed", "d_name":"Complete Order", "f_type":"button", "f_enable_calc":"controllEnableCalcInScope", "f_enable_indicators":{"quantity":0,"status":"fulfilled"}, "handler":"self", "container":"self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_complete", "css_class":"right"}
        ],
        "table_template":{
            "table_key":"eid",
            "fields":[
                {"f_id":"eid", "d_name":"ID", "f_type":"thead", "f_sort":"^"},
                {"f_id":"v_sku", "d_name":"SKU", "f_type":"thead", "f_sort":"^"},
                {"f_id":"v_description", "d_name":"Description", "f_type":"thead", "f_sort":"^"},
                {"f_id":"quantity", "d_name":"Quantity", "f_type":"thead", "f_edit":true, "f_enable_calc":"controllEnableCalcInScope", "f_enable_indicators":{"status":"fulfilled"}, "f_data_id":"eid", "f_data":"/api/recv/order_line_quantity"},
                {"f_id":"item_id", "d_name":"Item ID", "f_type":"thead"},
                {"f_id":"tran_id", "d_name":"Transaction", "f_type":"thead"},
                {"f_id":"status", "d_name":"Status", "f_type":"thead", "f_sort":"^"}
            ],
            "events":[
                {"f_id":"tran_id", "d_name":"Remove", "f_type":"button", "f_event_id":"remove", "f_enable_indicator":"quantity", "handler": "self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_line_remove"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT ol.*, i.v_description FROM order_lines ol INNER JOIN items i ON ol.item_id = i.eid WHERE order_id = %(eid)s ORDER BY ol.eid ASC;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_create": {
        "title": "Order Create Meta",
        "modal_template": {
            "fields":[
                {"f_id":"eid", "d_name":"ID", "f_type":"text", "f_element":"input", "f_attr":"disabled"},
                {"f_id":"title", "d_name":"Title", "f_type":"text", "f_element":"input"},
                {"f_id":"order_type", "d_name":"Order Type", "f_element":"select", "f_data":"/api/recv/order_type", "f_option_text":"option_abbr", "f_option_val":"option_code", "f_default_val":"recv", "f_attr":"disabled"},
                {"f_id":"status", "d_name":"Status", "f_element":"select", "f_data":"/api/recv/order_status", "f_option_text":"option_abbr", "f_option_val":"option_code", "f_default_val":"onorder"},
                {"f_id":"vendor_id", "d_name":"Vendor", "f_element":"select", "f_data":"/api/recv/order_vendor", "f_option_text":"acct_name", "f_option_val":"eid"},
                {"f_id":"remark", "d_name":"Remark", "f_type":"text", "f_element":"input"}
            ],
            "events":[
                {"f_id":"eid", "d_name":"Save", "f_type":"button", "f_event_id":"save", "handler": "self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_create"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "_query", "q_type":"insert", "q_table":"orders", "q_keyes":["eid"]
            }
        },
        "auth": ["admin","manager"]
    },
    "::order_line_manual": {
        "title": "Order Lines Create Meta",
        "fn_key":{"order_id":"eid"},
        "action_bar": [
            {"f_id":"new_item", "d_name":"New Item", "f_type":"button", "f_event_id":"new_item", "handler":"/js/part/fn_modal_input.js", "container":"dialog", "meta_endpoint": "/api/meta/route_meta", "meta_section": "invt.json::item_create"},
            {"f_id":"category", "f_event_id":"category", "d_name":"Category", "f_type":"select", "f_data":"/api/recv/item_category", "f_option_text":"option_abbr", "f_option_val":"option_code", "f_action_endpoint":"/api/recv/item_by_category"},
            {"f_id":"search", "f_event_id":"search", "d_name":"", "f_type":"input", "handler":"self", "container":"self", "f_action_endpoint":"/api/recv/item_search", "f_clear_onload":true},
            {"f_id":"quantity", "f_event_id":"quantity", "d_name":"Quantity", "f_type":"input", "handler":"self", "container":"self"}
        ],
        "table_template": {
            "fields":[
                {"f_id":"eid", "d_name":"ID", "f_type":"thead", "f_sort":"^"},
                {"f_id":"v_sku", "d_name":"SKU", "f_type":"thead", "f_sort":"^", "f_css_class": "td_nowrap"},
                {"f_id":"v_name", "d_name":"Item Name", "f_type":"thead", "f_sort":"^", "f_css_class": "td_nowrap"},
                {"f_id":"category", "d_name":"Category", "f_type":"thead", "f_sort":"^"},
                {"f_id":"vendor_code", "d_name":"Vendor", "f_type":"thead", "f_sort":"^"}
            ],
            "events":[
                {"f_id":"eid", "d_name":"Add to Order", "f_type":"button", "f_event_id":"add", "f_enable_indicator":"item_id", "f_qaram":{"order_id":"eid"}, "handler": "self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::order_line_create"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT i.eid, i.v_sku, i.v_name, i.category, i.equivalent, i.vendor_code, ol.item_id FROM items i LEFT OUTER JOIN (SELECT item_id FROM order_lines WHERE order_id = %(eid)s) ol on i.eid = ol.item_id join (select acct_code from accounts a join orders o on a.eid = o.vendor_id where o.eid = %(eid)s) v on v.acct_code = i.vendor_code;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_search": {
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT o.*, TO_CHAR(o.create_date, 'YYYY-MM-DD') as CreationDate, a.acct_name FROM orders o LEFT JOIN accounts a ON o.vendor_id = a.eid WHERE (o.title ILIKE %(search)s OR o.order_type ILIKE %(search)s OR o.status ILIKE %(search)s OR o.remark ILIKE %(search)s) AND o.order_type = 'recv' ORDER BY o.eid DESC;"
            }
        },
        "auth": []
    },
    "::order_update": {
        "data_endpoint": {
            "data": {
                "handler": "_query", "q_type":"update", "q_table":"orders", "q_keyes":["eid"]
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_delete": {
        "data_endpoint": {
            "data": {
                "handler": "_query_queue", 
                "query":[
                    {"exist_orderline_stop":"SELECT * FROM order_lines WHERE order_id = %(eid)s;"},
                    {"deleted_id":"DELETE FROM orders WHERE eid = %(eid)s;"}
                ]
            }
        },
        "auth": ["admin","manager"]
    },
    "::order_complete": {
        "data_endpoint": {
            "data": {
                "handler": "_query_queue", 
                "query":[
                    {"line_id":"UPDATE order_lines SET status = %(status)s, last_user = %(last_user)s, last_update = %(last_update)s WHERE order_id = %(eid)s;"},
                    {"tran_id":"UPDATE transactions SET status = %(status)s, last_user = %(last_user)s, last_update = %(last_update)s WHERE order_id = %(eid)s;"},
                    {"tran_id":"UPDATE orders SET status = %(status)s, last_user = %(last_user)s, last_update = %(last_update)s WHERE eid = %(eid)s;"},
                    {"tran_id":"UPDATE items SET last_user = %(last_user)s, last_update = %(last_update)s, quantity = (SELECT sum(CASE WHEN direction in ('inbound', 'adjustment') AND status in ('fulfilled', 'onorder') THEN t.quantity ELSE 0 END) - sum(CASE WHEN direction in ('outbound') AND status in ('fulfilled', 'onorder') THEN t.quantity ELSE 0 END) FROM transactions as t WHERE items.eid =  t.item_id) WHERE eid in (SELECT item_id FROM transactions WHERE order_id = %(eid)s);"},
                    {"return_data":"SELECT ol.*, i.v_description FROM order_lines ol INNER JOIN items i ON ol.item_id = i.eid WHERE order_id = %(eid)s;"}
                ],
                "q_params": {"status":"fulfilled"}
            }
        },
        "auth": ["admin","manager"]
    },
    "::order_line_create": {
        "data_endpoint": {
            "data": {
                "handler": "_query_queue", 
                "query":[
                    {"tran_id":"INSERT INTO transactions (order_id, item_id, quantity, direction, status) VALUES (%(order_id)s, %(eid)s, %(quantity)s, %(direction)s, %(status)s) RETURNING eid;"},
                    {"line_id":"INSERT INTO order_lines (order_id, v_sku, item_id, tran_id, quantity, status) select t.order_id, i.v_sku, t.item_id, t.eid, t.quantity, %(status)s from transactions t inner join items i on t.item_id = i.eid where t.eid = %(tran_id)s;"},
                    {"return_data":"SELECT i.eid, i.v_sku, i.v_name, i.category, i.equivalent, i.vendor_code, ol.item_id FROM items i LEFT OUTER JOIN (SELECT item_id FROM order_lines WHERE order_id = %(order_id)s) ol on i.eid = ol.item_id;"}
                ],
                "q_params": {"direction":"inbound", "status":"onorder"}
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_line_remove": {
        "data_endpoint": {
            "data": {
                "handler": "_query_queue", 
                "query":[
                    {"tran_id":"DELETE FROM order_lines WHERE order_id = %(order_id)s AND tran_id = %(tran_id)s;"},
                    {"line_id":"DELETE FROM transactions WHERE eid = %(tran_id)s;"},
                    {"return_data":"SELECT ol.*, i.v_description, i.category FROM order_lines ol INNER JOIN items i ON ol.item_id = i.eid WHERE order_id = %(order_id)s;"}
                ]
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_line_quantity": {
        "data_endpoint": {
            "data": {
                "handler": "_query_queue", 
                "query":[
                    {"line_id":"UPDATE order_lines SET quantity = %(quantity)s, last_user = %(last_user)s, last_update = %(last_update)s WHERE eid = %(eid)s;"},
                    {"tran_id":"UPDATE transactions SET quantity = %(quantity)s, last_user = %(last_user)s, last_update = %(last_update)s WHERE eid = (SELECT tran_id FROM order_lines WHERE eid = %(eid)s);"},
                    {"return_data":"SELECT ol.*, i.v_description, i.category FROM order_lines ol INNER JOIN items i ON ol.item_id = i.eid WHERE order_id = %(order_id)s ORDER BY ol.eid ASC;"}
                ],
                "q_params": {"direction":"inbound", "status":"onorder"}
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_label": {
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT * FROM orders WHERE eid = %(eid)s;"
            }
        },
        "auth": []
    },
    "::order_vendor": {
        "data_endpoint": {
            "data": {
                "handler": "_query", "q_type":"select", "q_table":"accounts", "q_fields":["eid", "acct_name"], "q_keyes":["acct_type", "is_active"], "q_params":{"acct_type":"vendor", "is_active":true}
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_type": {
        "data_endpoint": {
            "data": {
                "handler": "_query", "q_type":"select", "q_table":"data_codes", "q_fields":["option_code", "option_abbr"], "q_keyes":["refer_entity", "refer_column"], "q_params":{"refer_entity":"orders", "refer_column":"order_type"}
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::order_status": {
        "data_endpoint": {
            "data": {
                "handler": "_query", "q_type":"select", "q_table":"data_codes", "q_fields":["option_code", "option_abbr"], "q_keyes":["refer_entity", "refer_column"], "q_params":{"refer_entity":"orders", "refer_column":"status"}
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::item_category": {
        "data_endpoint": {
            "data": {
                "handler": "_query", "q_type":"select", "q_table":"data_codes", "q_fields":["option_code", "option_abbr"], "q_keyes":["refer_entity", "refer_column"], "q_params":{"refer_entity":"items", "refer_column":"category"}
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::item_by_category": {
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT i.eid, i.v_sku, i.v_name, i.category, i.equivalent, i.vendor_code, ol.item_id FROM items i LEFT OUTER JOIN (SELECT item_id FROM order_lines WHERE order_id = %(order_id)s) ol on i.eid = ol.item_id join (select acct_code from accounts a join orders o on a.eid = o.vendor_id where o.eid = %(order_id)s) v on v.acct_code = i.vendor_code WHERE i.category = %(category)s;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::item_search": {
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT i.eid, i.v_sku, i.v_name, i.category, i.equivalent, i.vendor_code, ol.item_id FROM items i LEFT OUTER JOIN (SELECT item_id FROM order_lines WHERE order_id = %(order_id)s) ol on i.eid = ol.item_id join (select acct_code from accounts a join orders o on a.eid = o.vendor_id where o.eid = %(order_id)s) v on v.acct_code = i.vendor_code WHERE i.v_sku Ilike %(search)s or i.v_name Ilike %(search)s or i.category Ilike %(search)s;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::recv_scan": {
        "title": "order Page Meta",
        "nav_bar": [
            {"f_id":"search", "f_event_id":"search_input", "d_name":"", "f_type":"input", "handler":"self", "container":"table", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::recv_scan_search"},
            {"f_id":"search", "f_event_id":"search_button", "d_name":"Search", "f_type":"button", "handler":"self", "container":"table", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::recv_scan_search"}
        ],
        "table_template":{
            "table_key":"eid",
            "header":[
                {"f_id":"table_data", "d_name":"order Count", "f_type":"label"}
            ],
            "caption":"order Information",
            "fields":[
                {"f_id":"eid", "d_name":"Order ID", "f_type":"thead", "f_sort":"^"},
                {"f_id":"title", "d_name":"Receive Order", "f_type":"thead", "f_sort":"^"},
                {"f_id":"order_type", "d_name":"Order Type", "f_type":"thead", "f_sort":"^"},
                {"f_id":"status", "d_name":"Status", "f_type":"thead", "f_sort":"^"},
                {"f_id":"CreationDate", "d_name":"Create Date", "f_type":"thead"},
                {"f_id":"acct_name", "d_name":"Vendor", "f_type":"thead"},
                {"f_id":"remark", "d_name":"Remark", "f_type":"thead", "f_sort":"^"}
            ],
            "events":[
                {"f_id":"eid", "d_name":"Scan", "f_type":"button", "f_event_id":"scan", "handler": "/js/part/fn_v2_scan_recv.js", "container":"self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::recv_scan_input"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT o.*, TO_CHAR(o.create_date, 'YYYY-MM-DD') as CreationDate, a.acct_name FROM orders o LEFT JOIN accounts a on o.vendor_id = a.eid WHERE o.order_type = 'recv' AND o.status = 'onorder' ORDER BY o.eid DESC;"
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::recv_scan_search": {
        "data_endpoint": {
            "data": {
                "handler": "read",
                "query": "SELECT o.*, TO_CHAR(o.create_date, 'YYYY-MM-DD') as CreationDate, a.acct_name FROM orders o LEFT JOIN accounts a ON o.vendor_id = a.eid WHERE (o.title ILIKE %(search)s OR o.order_type ILIKE %(search)s OR o.status ILIKE %(search)s OR o.remark ILIKE %(search)s) AND o.order_type = 'recv' ORDER BY o.eid DESC;"
            }
        },
        "auth": []
    },
    "::recv_scan_input": {
        "title": "order View Meta",
        "title_template":{
            "data_source":"order_notfoundstop",
            "fields":[
                {"f_id":"eid", "d_name":"Order ID", "f_element":"h3"},
                {"f_id":"title", "d_name":"Order Title", "f_element":"h3"},
                {"f_id":"local_error_msg", "d_name":"Error", "f_element":"h2"}
            ]
        },
        "action_template": {
            "fields":[
                {"f_id":"serial_number", "f_event_id":"scan_input", "d_name":"Scan Serial Number", "f_element":"input", "f_type":"text", "handler":"self", "container":"self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::recv_scan_serial"},
                {"f_id":"serial_number", "f_event_id":"scan_button", "f_event_data":"serial_number", "d_name":"Scan Serial Number", "f_element":"button", "handler":"self", "container":"self", "meta_endpoint": "/api/meta/route_meta", "meta_section": "recv.json::recv_scan_serial"}
            ]
        },
        "table_template":{
            "data_source":"table_data",
            "template_key":"eid",
            "header":[
                {"f_id":"table_data", "d_name":"Set Count", "f_element":"label"}
            ],
            "caption":"Recv Station Information",
            "fields":[
                {"f_id":"eid", "d_name":"ID", "f_element":"thead", "f_sort":"^"},
                {"f_id":"title", "d_name":"Order ID", "f_element":"thead", "f_sort":"^"},
                {"f_id":"serial_number", "d_name":"Unit SN", "f_element":"thead", "f_sort":"^"}
            ]
        },
        "data_endpoint": {
            "data": {
                "handler": "_query_queue",
                "query": [
                    {"order_notfoundstop":"SELECT eid, title, order_type, model_id, vendor_id, status, remark, TO_CHAR(create_date, 'YYYY-MM-DD') as create_date FROM orders WHERE eid = %(eid)s;"},
                    {"table_data":"SELECT rs.*, o.title FROM recv_serial rs INNER JOIN orders o ON rs.order_id = o.eid WHERE rs.order_id = %(eid)s;"}
                ]
            }
        },
        "auth": ["admin","manager","prsentry"]
    },
    "::recv_scan_serial": {
        "data_endpoint": {
            "data": {
                "handler": "_query_queue",
                "query": [
                    {"duplicate_stop":"SELECT * FROM recv_serial WHERE serial_number = %(serial_number)s;"},
                    {"order_notfoundstop":"SELECT * FROM orders o WHERE o.eid = %(eid)s;"},
                    {"recv_serial_id":"INSERT INTO recv_serial (order_id, serial_number, vendor_id, create_user) SELECT o.eid, %(serial_number)s, o.vendor_id, %(last_user)s FROM orders o WHERE o.eid = %(eid)s;"},
                    {"table_data":"SELECT rs.*, o.title FROM recv_serial rs INNER JOIN orders o ON rs.order_id = o.eid WHERE rs.order_id = %(eid)s;"}
                ]
            }
        },
        "auth": ["admin","manager","prsentry"]
    }
}